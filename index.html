<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Signage Adzan + Video (Medan)</title>

  <!-- CSS utama (RELATIF) -->
  <link rel="stylesheet" href="css/index-style.css?v=6" />

  <!-- Fallback CSS super-minimal bila file di atas gagal dimuat -->
  <style>
    #bg-video{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;background:#000;z-index:0}
    .widget-strip{
      position:fixed;left:50%;transform:translateX(-50%);bottom:0;
      width:clamp(260px,96vw,880px);padding:6px 10px; padding-bottom:calc(6px + env(safe-area-inset-bottom));
      border-radius:12px 12px 0 0;
      background:rgba(15,27,24,.45);color:#fff;display:flex;gap:8px;align-items:center;justify-content:space-between;
      z-index:9999;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif
    }
    .widget-strip .mid span{margin:0 6px}
    .dot{width:6px;height:6px;border-radius:50%;background:#66d1bf;display:inline-block}
    .right{background:rgba(20,52,46,.35);padding:4px 8px;border-radius:999px;font-size:12px}
  </style>
</head>
<body>
  <!-- Video latar -->
  <video
    id="bg-video"
    muted autoplay loop playsinline webkit-playsinline preload="auto"
    disablepictureinpicture controlslist="nodownload noplaybackrate noremoteplayback"
    aria-hidden="true"
  ></video>

  <!-- Widget jadwal -->
  <div class="widget-strip" role="region" aria-label="Widget jadwal sholat">
    <div class="left">
      <span class="dot" aria-hidden="true"></span>
      <b id="current-time" aria-live="polite">--:--:--</b>
      <span class="tz">WIB • Asia/Jakarta</span>
    </div>

    <div class="mid">
      <span>Subuh: <b id="subuh">--:--</b></span>
      <span>Dzuhur: <b id="dzuhur">--:--</b></span>
      <span>Ashar: <b id="ashar">--:--</b></span>
      <span>Maghrib: <b id="maghrib">--:--</b></span>
      <span>Isya: <b id="isya">--:--</b></span>
    </div>

    <div class="right" id="status-pill">Memulai…</div>
  </div>

  <!-- Audio -->
  <audio id="adzan-audio" preload="auto">
    <source src="assets/adzan.mp3" type="audio/mpeg" />
  </audio>
  <audio id="indonesia-raya" preload="auto">
    <source src="assets/indonesia-raya.mp3" type="audio/mpeg" />
  </audio>

  <!-- Fallback clock aman untuk Tizen (aktif hanya jika app.js tidak update jam) -->
  <script>
  (function(){
    function pad2(n){ return n<10?'0'+n:''+n; }
    function getWIB(){
      var now=new Date();
      var localOffsetMin = -now.getTimezoneOffset();  // WIB = +420
      var deltaMin = 420 - localOffsetMin;            // konversi dari zona lokal -> WIB
      var t = new Date(now.getTime() + deltaMin*60000);
      return pad2(t.getHours())+':'+pad2(t.getMinutes())+':'+pad2(t.getSeconds());
    }
    function startFallback(){
      if (window.__fallbackClockRunning) return;
      window.__fallbackClockRunning = true;
      function tick(){
        var el=document.getElementById('current-time');
        if (el) el.textContent=getWIB();
      }
      function schedule(){
        var ms=1000 - (Date.now()%1000) + 5;
        window.__fallbackTimer = setTimeout(function(){ tick(); schedule(); }, ms);
      }
      tick(); schedule();
    }
    function watchdog(){
      var el=document.getElementById('current-time');
      if (!el){ startFallback(); return; }
      var first = el.textContent;
      setTimeout(function(){
        var second = el.textContent;
        // Start fallback jika jam belum diupdate (masih placeholder / tidak berubah)
        if (second === first || second.indexOf('--') !== -1){ startFallback(); }
      }, 1600);
    }
    if (document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', watchdog); }
    else { watchdog(); }
  })();
  </script>

  <!-- JS utama (RELATIF) -->
  <script src="js/app.js?v=7" defer></script>
</body>
</html>
