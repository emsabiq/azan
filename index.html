<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Signage Adzan + Video (Medan)</title>

  <!-- UBAH jika deploy di subfolder, mis. /azan/ -->
  <base href="/" />

  <!-- CSS utama -->
  <link rel="stylesheet" href="/css/index-style.css?v=2" />

  <!-- CSS fallback minimal (tetap center kalau CSS eksternal gagal) -->
  <style>
    #bg-video{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;background:#000;z-index:0}
    .widget-strip{
      position:fixed;bottom:0;left:50%;transform:translateX(-50%);
      width:90vw;max-width:860px;padding:6px 10px;border-radius:12px 12px 0 0;
      background:rgba(0,0,0,.40);color:#fff;display:flex;gap:8px;align-items:center;
      justify-content:space-between;z-index:9999;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif
    }
    .widget-strip .mid span{margin:0 6px}
    .dot{width:6px;height:6px;border-radius:50%;background:#66d1bf;display:inline-block}
  </style>
</head>
<body>
  <!-- Video latar -->
  <video
    id="bg-video"
    muted autoplay loop playsinline webkit-playsinline preload="auto"
    disablepictureinpicture controlslist="nodownload noplaybackrate noremoteplayback"
  ></video>

  <!-- Widget jadwal (center & rapat bawah) -->
  <div class="widget-strip" role="region" aria-label="Widget jadwal sholat">
    <div class="left">
      <span class="dot" aria-hidden="true"></span>
      <b id="current-time">--:--:--</b>
      <span class="tz">WIB • Asia/Jakarta</span>
    </div>

    <div class="mid">
      <span>Subuh: <b id="subuh">--:--</b></span>
      <span>Dzuhur: <b id="dzuhur">--:--</b></span>
      <span>Ashar: <b id="ashar">--:--</b></span>
      <span>Maghrib: <b id="maghrib">--:--</b></span>
      <span>Isya: <b id="isya">--:--</b></span>
    </div>

    <div class="right" id="status-pill">Memulai…</div>
  </div>

  <!-- Audio -->
  <audio id="adzan-audio" preload="auto">
    <source src="/assets/adzan.mp3" type="audio/mpeg" />
  </audio>
  <audio id="indonesia-raya" preload="auto">
    <source src="/assets/indonesia-raya.mp3" type="audio/mpeg" />
  </audio>

  <!-- JS utama -->
  <script src="/js/app.js?v=9" defer onload="window.__APPJS_LOADED__=true"></script>

  <!-- Fallback jam WIB: AKTIF HANYA jika app.js belum update dalam 3 detik -->
  <script>
  (function(){
    function pad(n){return n<10?'0'+n:''+n;}
    function wibNow(){
      const now = new Date();
      // lokal -> UTC -> WIB (+7 jam), lalu pakai getter UTC agar stabil
      const utcMs = now.getTime() + now.getTimezoneOffset()*60000;
      const w = new Date(utcMs + 7*3600*1000);
      return pad(w.getUTCHours())+':'+pad(w.getUTCMinutes())+':'+pad(w.getUTCSeconds());
    }
    function startFallback(){
      if (window.__WIB_TICKER_FALLBACK__) return;
      const tick = () => {
        var el = document.getElementById('current-time');
        if (el) el.textContent = wibNow();
        window.__WIB_TICKER_FALLBACK__ = setTimeout(tick, 1000 - (Date.now()%1000) + 5);
      };
      tick();
    }
    window.addEventListener('DOMContentLoaded', function(){
      // Tunggu app.js: kalau dalam 3s masih '--:--:--', hidupkan fallback
      setTimeout(function(){
        if (window.__WIB_TICKER__) return; // app.js anti-drift sudah aktif
        var el = document.getElementById('current-time');
        if (!el) return;
        var t = (el.textContent||'').trim();
        if (t === '' || t.indexOf('--') !== -1) {
          startFallback();
        }
      }, 3000);
    });
  })();
  </script>

  <noscript>Aktifkan JavaScript untuk menampilkan jam, jadwal, dan pemutar video.</noscript>
</body>
</html>
